# 验收标准（Acceptance Criteria）v1.0

本文档用于 AI agent 开发自检与人工验收，覆盖 Sprint 1 到 Sprint 3 的核心链路。

## 1. 全局验收门槛
1. 所有新增接口必须在 `docs/OPENAPI.yaml` 中定义。
2. 所有核心流程必须具备至少 1 条集成测试。
3. 所有页面核心操作必须有错误提示与空态处理。
4. 所有数据访问必须按 `user_id` 隔离。
5. 无 P0/P1 缺陷后方可进入下一 Sprint。

## 2. Sprint 1 验收

### AC-S1-01 项目与环境
1. 代码仓可一键安装依赖并启动前后端。
2. 数据库迁移可 `up/down` 成功执行。
3. CI 至少包含 `lint/test/build` 三项。

### AC-S1-02 鉴权
1. 可完成注册、登录、刷新 token。
2. 未登录访问受保护接口返回 401。
3. 登录后可访问当前用户资源。

### AC-S1-03 作品管理
1. 可创建作品（名称、题材、目标字数、更新频率）。
2. 列表仅返回当前用户作品。
3. 作品详情可读取且字段完整。

### AC-S1-04 设定库
1. 支持 `character|realm|skill|faction|item|location` 六类设定。
2. 可新增、查询、更新设定条目。
3. 参数非法时返回 400 且含字段错误信息。

### AC-S1-05 编辑器与版本
1. 可创建/加载章节并编辑正文。
2. 自动保存有效（正文刷新后不丢失）。
3. 可创建手动快照并查看版本列表。

## 3. Sprint 2 验收

### AC-S2-01 大纲生成
1. 输入题材与主线信息后可生成卷-章结构。
2. 每章至少包含目标、冲突、钩子字段。
3. 锁定章节后再次生成不覆盖锁定内容。

### AC-S2-02 章节共写
1. 支持续写/改写/扩写/压缩四种模式。
2. 可配置篇幅、节奏、风格参数。
3. 草稿可逐段采纳并写入章节正文。

## 4. Sprint 3 验收

### AC-S3-01 一致性检查
1. 能识别至少三类问题：人设冲突、战力冲突、时间线冲突。
2. 每个问题包含位置、类型、建议。
3. 支持对单个问题应用修复建议。

### AC-S3-02 版本能力完善
1. 可进行章节版本 Diff 对比（段落级）。
2. 可回滚到指定版本。
3. 回滚后内容与目标版本一致。

### AC-S3-03 导出
1. 支持 TXT/Docx 导出。
2. 导出文档章节顺序正确，无乱码。
3. 导出失败有可读错误信息与重试能力。

## 5. 性能与稳定性验收
1. 2000 字章节生成首包响应 < 6s，完整输出 < 30s（测试环境基线）。
2. API P95 延迟满足内部阈值（由监控面板可见）。
3. AI 任务失败率、重试率可在监控中查询。

## 6. 安全与合规验收
1. 用户文本默认不用于训练。
2. 日志不记录完整正文，仅记录脱敏信息。
3. 提供用户数据删除流程（软删 + 延迟硬删）。

## 7. 端到端验收场景
1. 创建作品。
2. 新增至少 3 条设定（角色/境界/功法）。
3. 生成大纲并锁定 1 章。
4. 使用章节共写生成草稿并应用。
5. 执行一致性检查并应用 1 条修复。
6. 创建快照并回滚验证。
7. 导出 TXT/Docx 成功。

以上 7 步全部通过视为 MVP 可发布到灰度环境。
